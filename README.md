# Outlook é‚®ä»¶ç®¡ç†å·¥å…·

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Outlook é‚®ä»¶ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šç§æ–¹å¼è¯»å– Outlook é‚®ç®±é‚®ä»¶ï¼Œå¹¶æä¾› Web ç•Œé¢è¿›è¡Œé‚®ç®±è´¦å·ç®¡ç†å’Œé‚®ä»¶æŸ¥çœ‹ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### é‚®ä»¶è¯»å–æ–¹å¼
æœ¬å·¥å…·æ”¯æŒä¸‰ç§æ–¹å¼è¯»å– Outlook é‚®ç®±é‚®ä»¶ï¼š

1. **æ—§ç‰ˆ IMAP æ–¹å¼** - ä½¿ç”¨ `outlook.office365.com` æœåŠ¡å™¨
2. **æ–°ç‰ˆ IMAP æ–¹å¼** - ä½¿ç”¨ `outlook.live.com` æœåŠ¡å™¨
3. **Graph API æ–¹å¼** - ä½¿ç”¨ Microsoft Graph APIï¼ˆæ¨èï¼‰

### Web åº”ç”¨åŠŸèƒ½
- ğŸ” **ç™»å½•éªŒè¯** - å¯†ç ä¿æŠ¤çš„ Web ç•Œé¢ï¼Œæ”¯æŒåœ¨çº¿ä¿®æ”¹å¯†ç 
- ğŸ“ **åˆ†ç»„ç®¡ç†** - æ”¯æŒåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤é‚®ç®±åˆ†ç»„ï¼Œè‡ªå®šä¹‰åˆ†ç»„é¢œè‰²
- ğŸ“§ **å¤šé‚®ç®±ç®¡ç†** - æ‰¹é‡å¯¼å…¥å’Œç®¡ç†å¤šä¸ª Outlook é‚®ç®±è´¦å·
- ğŸ“¬ **é‚®ä»¶æŸ¥çœ‹** - æŸ¥çœ‹æ”¶ä»¶ç®±ã€åƒåœ¾é‚®ä»¶å’Œå·²åˆ é™¤é‚®ä»¶
- ğŸ” **å…¨å±æŸ¥çœ‹** - æ”¯æŒå…¨å±æ¨¡å¼æŸ¥çœ‹é‚®ä»¶ï¼Œå®Œæ•´å±•ç¤ºé•¿é‚®ä»¶å†…å®¹ï¼ˆâ­ 2026-01-23 æ–°å¢ï¼‰
- ğŸ“¤ **å¯¼å‡ºåŠŸèƒ½** - æ”¯æŒæŒ‰åˆ†ç»„æˆ–å…¨éƒ¨å¯¼å‡ºé‚®ç®±è´¦å·ä¿¡æ¯
- ğŸ¨ **ç°ä»£åŒ– UI** - ç®€æ´ç¾è§‚çš„å››æ å¼ç•Œé¢å¸ƒå±€
- âš¡ **æ€§èƒ½ä¼˜åŒ–** - æ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼Œå¿«é€Ÿåˆ‡æ¢åˆ†ç»„å’Œé‚®ç®±
- ğŸ“„ **åˆ†é¡µåŠ è½½** - é‚®ä»¶åˆ—è¡¨æ”¯æŒæ»šåŠ¨åˆ°åº•éƒ¨è‡ªåŠ¨åŠ è½½ä¸‹ä¸€é¡µï¼ˆæ¯é¡µ20å°ï¼‰
- ğŸ—‘ï¸ **å¤šæ–‡ä»¶å¤¹æ”¯æŒ** - æ”¯æŒæŸ¥çœ‹æ”¶ä»¶ç®±ã€åƒåœ¾é‚®ä»¶ã€å·²åˆ é™¤é‚®ä»¶
- ğŸ”¥ **ä¸´æ—¶é‚®ç®±** - é›†æˆ GPTMail APIï¼Œä¸€é”®ç”Ÿæˆä¸´æ—¶é‚®ç®±
- âš™ï¸ **ç³»ç»Ÿè®¾ç½®** - æ”¯æŒåœ¨çº¿ä¿®æ”¹ç™»å½•å¯†ç å’Œ GPTMail API Key
- ğŸ”„ **OAuth2 åŠ©æ‰‹** - å†…ç½® OAuth2 æˆæƒæµç¨‹ï¼Œå¿«é€Ÿè·å– Refresh Token
- ğŸ” **Token åˆ·æ–°ç®¡ç†** - å…¨é‡åˆ·æ–°æ‰€æœ‰è´¦å· Tokenï¼Œå®æ—¶è¿›åº¦å±•ç¤ºï¼Œé˜²æ­¢ 90 å¤©è¿‡æœŸï¼ˆâ­ 2026-01-23 æ–°å¢ï¼‰

### ç•Œé¢å¸ƒå±€
Web åº”ç”¨é‡‡ç”¨å››æ å¼å¸ƒå±€è®¾è®¡ï¼š
1. **åˆ†ç»„é¢æ¿** - æ˜¾ç¤ºæ‰€æœ‰é‚®ç®±åˆ†ç»„ï¼Œç‚¹å‡»åˆ‡æ¢
2. **é‚®ç®±é¢æ¿** - æ˜¾ç¤ºå½“å‰åˆ†ç»„ä¸‹çš„é‚®ç®±è´¦å·åˆ—è¡¨
3. **é‚®ä»¶åˆ—è¡¨** - æ˜¾ç¤ºé€‰ä¸­é‚®ç®±çš„é‚®ä»¶ï¼Œæ”¯æŒåˆ‡æ¢æ–‡ä»¶å¤¹å’Œæ»šåŠ¨åŠ è½½
4. **é‚®ä»¶è¯¦æƒ…** - æ˜¾ç¤ºé€‰ä¸­é‚®ä»¶çš„å®Œæ•´å†…å®¹ï¼ˆæ”¯æŒ HTML æ¸²æŸ“ï¼‰

## ğŸ“¸ ç•Œé¢é¢„è§ˆ

### é‚®ç®±åˆ—è¡¨ç•Œé¢
![é‚®ç®±åˆ—è¡¨](img/é‚®ç®±åˆ—è¡¨.png)

### å¯¼å…¥é‚®ç®±è´¦å·
![å¯¼å…¥é‚®ç®±è´¦å·](img/å¯¼å…¥é‚®ç®±è´¦å·.png)

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Dockerï¼ˆæ¨èï¼‰

ç›´æ¥ä½¿ç”¨ GitHub Actions è‡ªåŠ¨æ„å»ºçš„é•œåƒï¼Œæ— éœ€æœ¬åœ°æ„å»ºï¼š

```bash
# æ‹‰å–æœ€æ–°é•œåƒ
docker pull ghcr.io/assast/outlookemail:latest

# è¿è¡Œå®¹å™¨
docker run -d \
  --name outlook-mail-reader \
  -p 5000:5000 \
  -v $(pwd)/data:/app/data \
  -e LOGIN_PASSWORD=admin123 \
  -e SECRET_KEY=your-secret-key-here \
  ghcr.io/assast/outlookemail:latest

# æŸ¥çœ‹æ—¥å¿—
docker logs -f outlook-mail-reader

# åœæ­¢å®¹å™¨
docker stop outlook-mail-reader
docker rm outlook-mail-reader
```

**é¦–æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨ï¼š**
- åˆ›å»ºæ•°æ®ç›®å½•
- åˆå§‹åŒ–æ•°æ®åº“
- åˆ›å»ºé»˜è®¤åˆ†ç»„å’Œä¸´æ—¶é‚®ç®±åˆ†ç»„
- è®¾ç½®é»˜è®¤å¯†ç ï¼ˆadmin123ï¼‰

### æ–¹å¼äºŒï¼šä½¿ç”¨ Python ç›´æ¥è¿è¡Œ

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/assast/outlookEmail.git
cd outlookEmail

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰
export LOGIN_PASSWORD=admin123
export SECRET_KEY=your-secret-key-here
export PORT=5000

# è¿è¡Œåº”ç”¨
python web_outlook_app.py
```

è®¿é—® `http://localhost:5000` å³å¯ä½¿ç”¨ã€‚

### ä½¿ç”¨ Docker Compose

ä¿®æ”¹ `docker-compose.yml` ä½¿ç”¨é¢„æ„å»ºé•œåƒï¼š

```yaml
version: '3.8'

services:
  outlook-mail-reader:
    image: ghcr.io/assast/outlookemail:latest
    container_name: outlook-mail-reader
    ports:
      - "5000:5000"
    volumes:
      - ./data:/app/data
    environment:
      - LOGIN_PASSWORD=admin123
      - FLASK_ENV=production
    restart: unless-stopped
```

ç„¶åå¯åŠ¨æœåŠ¡ï¼š

```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

åœ¨ `docker-compose.yml` ä¸­å¯ä»¥é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `SECRET_KEY` | Session å¯†é’¥ï¼ˆå»ºè®®ä¿®æ”¹ï¼‰ | `outlook-mail-reader-secret-key-change-in-production` |
| `LOGIN_PASSWORD` | ç™»å½•å¯†ç  | `admin123` |
| `FLASK_ENV` | è¿è¡Œç¯å¢ƒ | `production` |
| `PORT` | åº”ç”¨ç«¯å£ | `5000` |
| `HOST` | ç›‘å¬åœ°å€ | `0.0.0.0` |
| `DATABASE_PATH` | æ•°æ®åº“è·¯å¾„ | `data/outlook_accounts.db` |
| `GPTMAIL_BASE_URL` | GPTMail API åœ°å€ | `https://mail.chatgpt.org.uk` |
| `GPTMAIL_API_KEY` | GPTMail API Key | `gpt-test` |
| `OAUTH_CLIENT_ID` | OAuth å®¢æˆ·ç«¯ ID | `å»ºè®®ä½¿ç”¨è‡ªå·±çš„ï¼Œå¦‚æœå®åœ¨æä¸åˆ°ä¸å¡«çš„è¯ä¼šä½¿ç”¨é»˜è®¤çš„` |
| `OAUTH_REDIRECT_URI` | OAuth é‡å®šå‘ URI | `å»ºè®®ä½¿ç”¨è‡ªå·±çš„ï¼Œå¦‚æœå®åœ¨æä¸åˆ°ä¸å¡«çš„è¯ä¼šä½¿ç”¨é»˜è®¤çš„` |

### æ•°æ®æŒä¹…åŒ–

æ•°æ®åº“æ–‡ä»¶å­˜å‚¨åœ¨ `./data` ç›®å½•ä¸­ï¼Œé€šè¿‡ Docker Volume æŒ‚è½½å®ç°æŒä¹…åŒ–ã€‚

æ•°æ®åº“åŒ…å«ä»¥ä¸‹è¡¨ï¼š
- `settings` - ç³»ç»Ÿè®¾ç½®ï¼ˆç™»å½•å¯†ç ã€API Key ç­‰ï¼‰
- `groups` - é‚®ç®±åˆ†ç»„
- `accounts` - Outlook é‚®ç®±è´¦å·
- `account_refresh_logs` - è´¦å·åˆ·æ–°è®°å½•ï¼ˆâ­ 2026-01-23 æ–°å¢ï¼‰
- `temp_emails` - ä¸´æ—¶é‚®ç®±
- `temp_email_messages` - ä¸´æ—¶é‚®ç®±çš„é‚®ä»¶

### ç«¯å£æ˜ å°„

é»˜è®¤æ˜ å°„ 5000 ç«¯å£ï¼Œå¯ä»¥åœ¨ `docker-compose.yml` ä¸­ä¿®æ”¹ï¼š

```yaml
ports:
  - "8080:5000"  # å°†å®¹å™¨çš„ 5000 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 8080 ç«¯å£
```

## ğŸš€ Docker éƒ¨ç½²

### ä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

ä¿®æ”¹ `docker-compose.yml` ä½¿ç”¨é¢„æ„å»ºé•œåƒï¼š

```yaml
version: '3.8'

services:
  outlook-mail-reader:
    image: ghcr.io/assast/outlookemail:latest
    container_name: outlook-mail-reader
    ports:
      - "5000:5000"
    volumes:
      - ./data:/app/data
    environment:
      - LOGIN_PASSWORD=admin123
      - SECRET_KEY=your-secret-key-here
      - FLASK_ENV=production
      - GPTMAIL_API_KEY=your-api-key
    restart: unless-stopped
```

ç„¶åå¯åŠ¨æœåŠ¡ï¼š

```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

### é•œåƒè¯´æ˜

é¡¹ç›®ä½¿ç”¨ GitHub Actions è‡ªåŠ¨æ„å»ºå¹¶æ¨é€ Docker é•œåƒåˆ° `ghcr.io/assast/outlookemail:latest`ã€‚

#### å¯ç”¨é•œåƒæ ‡ç­¾

- `ghcr.io/assast/outlookemail:latest` - æœ€æ–°çš„ä¸»åˆ†æ”¯æ„å»ºï¼ˆæ¨èï¼‰
- `ghcr.io/assast/outlookemail:main` - main åˆ†æ”¯æœ€æ–°ç‰ˆæœ¬

#### æ›´æ–°é•œåƒ

```bash
# æ‹‰å–æœ€æ–°é•œåƒ
docker pull ghcr.io/assast/outlookemail:latest

# é‡å¯å®¹å™¨
docker-compose down
docker-compose up -d
```

#### è‡ªå·±æ„å»ºé•œåƒï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦ä¿®æ”¹ä»£ç æˆ–è‡ªå®šä¹‰æ„å»ºï¼š

```bash
# æ„å»ºé•œåƒ
docker build -t outlook-mail-reader .

# è¿è¡Œè‡ªå·±æ„å»ºçš„é•œåƒ
docker run -d \
  --name outlook-mail-reader \
  -p 5000:5000 \
  -v $(pwd)/data:/app/data \
  -e LOGIN_PASSWORD=admin123 \
  outlook-mail-reader
```

## ğŸ“– ä½¿ç”¨è¯´æ˜

### 1. è·å– OAuth2 å‡­è¯

è¦ä½¿ç”¨æœ¬å·¥å…·ï¼Œæ‚¨éœ€è¦è·å–ä»¥ä¸‹ OAuth2 å‡­è¯ï¼š

1. **Client ID** - Microsoft Azure åº”ç”¨æ³¨å†Œçš„å®¢æˆ·ç«¯ ID
2. **Refresh Token** - OAuth2 åˆ·æ–°ä»¤ç‰Œ

#### æ­¥éª¤ 1ï¼šæ³¨å†Œ Azure åº”ç”¨

è®¿é—® [Azure Portal](https://portal.azure.com/)ï¼Œè¿›å…¥ã€Œåº”ç”¨æ³¨å†Œã€ï¼š

![åº”ç”¨æ³¨å†Œ](img/åº”ç”¨æ³¨å†Œ.png)

#### æ­¥éª¤ 2ï¼šåˆ›å»ºæ–°åº”ç”¨

ç‚¹å‡»ã€Œæ–°æ³¨å†Œã€ï¼Œå¡«å†™åº”ç”¨ä¿¡æ¯ï¼š

![æ³¨å†Œåº”ç”¨ç¨‹åº](img/æ³¨å†Œåº”ç”¨ç¨‹åº.png)

- **åç§°**ï¼šè‡ªå®šä¹‰åº”ç”¨åç§°
- **æ”¯æŒçš„è´¦æˆ·ç±»å‹**ï¼šé€‰æ‹©ã€Œä»»ä½•ç»„ç»‡ç›®å½•ä¸­çš„è´¦æˆ·å’Œä¸ªäºº Microsoft è´¦æˆ·ã€
- **é‡å®šå‘ URI**ï¼šé€‰æ‹©ã€Œå…¬å…±å®¢æˆ·ç«¯/æœ¬æœºã€ï¼Œå¡«å†™ `http://localhost:8080`

#### æ­¥éª¤ 3ï¼šè·å–åº”ç”¨ç¨‹åº ID

åˆ›å»ºå®Œæˆåï¼Œå¤åˆ¶ã€Œåº”ç”¨ç¨‹åº(å®¢æˆ·ç«¯) IDã€ï¼š

![è·å–åº”ç”¨ç¨‹åºID](img/è·å–åº”ç”¨ç¨‹åºID.png)

#### æ­¥éª¤ 4ï¼šé…ç½® API æƒé™  è¿™ä¸€æ­¥åº”è¯¥å¯ä»¥çœç•¥ï¼Œç›®å‰å†…ç½®çš„å®¢æˆ·ç«¯idå°±æ²¡æœ‰è®¾ç½®è¿™ä¸€æ­¥ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨

åœ¨ã€ŒAPI æƒé™ã€ä¸­æ·»åŠ ä»¥ä¸‹æƒé™ï¼š
- `offline_access` - è·å–åˆ·æ–°ä»¤ç‰Œ
- `Mail.Read` - è¯»å–é‚®ä»¶
- `Mail.ReadWrite` - è¯»å†™é‚®ä»¶
- `User.Read` - è¯»å–ç”¨æˆ·ä¿¡æ¯
- `IMAP.AccessAsUser.All` - IMAP è®¿é—®

#### æ­¥éª¤ 5ï¼šè·å– Refresh Token

ä½¿ç”¨æœ¬å·¥å…·å†…ç½®çš„ OAuth2 åŠ©æ‰‹è·å– Refresh Tokenï¼š

![æ¢å–token](img/æ¢å–token.png)

1. åœ¨ Web ç•Œé¢ç‚¹å‡»ã€Œè·å– Tokenã€æŒ‰é’®
2. ç‚¹å‡»ã€Œç”Ÿæˆæˆæƒé“¾æ¥ã€
3. å¤åˆ¶é“¾æ¥åˆ°æµè§ˆå™¨æ‰“å¼€ï¼Œå®Œæˆæˆæƒ
4. å¤åˆ¶æˆæƒåçš„å®Œæ•´ URLï¼ˆå¤„äºå®‰å…¨è€ƒè™‘ï¼Œæˆ‘æ²¡æœ‰ç»Ÿä¸€å»ºè®¾æˆæƒå›è°ƒæœåŠ¡ï¼Œæ‰€æœ‰æˆæƒéƒ½åœ¨è‡ªå·±éƒ¨ç½²çš„æœåŠ¡å†…å®Œæˆï¼Œä¸ä¼šå¤–æ³„ï¼Œæ‰€ä»¥é‡å®šå‘URIä¸ºhttp://localhost:8080ï¼Œè¿™ä¸ªé“¾æ¥è‚¯å®šæ˜¯æ‰“ä¸å¼€çš„ï¼Œæ‰€ä»¥è¦å¤åˆ¶è¿‡æ¥åœ¨éƒ¨ç½²çš„æœåŠ¡èµ°ååŠæ®µçš„æ¢å–Refresh Tokenï¼‰
5. ç²˜è´´åˆ°ã€Œæˆæƒåçš„ URLã€è¾“å…¥æ¡†
6. ç‚¹å‡»ã€Œæ¢å– Tokenã€æŒ‰é’®
7. å¤åˆ¶è·å¾—çš„ Refresh Token

### 2. å¯¼å…¥é‚®ç®±è´¦å·

åœ¨ Web ç•Œé¢ä¸­ï¼Œç‚¹å‡»ã€Œå¯¼å…¥é‚®ç®±ã€æŒ‰é’®ï¼ŒæŒ‰ä»¥ä¸‹æ ¼å¼è¾“å…¥è´¦å·ä¿¡æ¯ï¼š

```
é‚®ç®±----å¯†ç ----client_id----refresh_token
```

ç¤ºä¾‹ï¼š
```
user@outlook.com----password123----24d9a0ed-8787-4584-883c-2fd79308940a----0.AXEA...
```

æ”¯æŒæ‰¹é‡å¯¼å…¥ï¼Œæ¯è¡Œä¸€ä¸ªè´¦å·ã€‚**æ³¨æ„ï¼šå¯¼å…¥é‚®ç®±æ—¶ä¸èƒ½é€‰æ‹©ä¸´æ—¶é‚®ç®±åˆ†ç»„ã€‚**

### 3. æŸ¥çœ‹é‚®ä»¶

1. ä»å·¦ä¾§é€‰æ‹©åˆ†ç»„
2. é€‰æ‹©é‚®ç®±è´¦å·
3. ç‚¹å‡»ã€Œè·å–é‚®ä»¶ã€æŒ‰é’®
4. åˆ‡æ¢ã€Œæ”¶ä»¶ç®±ã€ã€ã€Œåƒåœ¾é‚®ä»¶ã€æˆ–ã€Œå·²åˆ é™¤ã€æ ‡ç­¾æŸ¥çœ‹ä¸åŒæ–‡ä»¶å¤¹çš„é‚®ä»¶
5. æ»šåŠ¨åˆ°é‚®ä»¶åˆ—è¡¨åº•éƒ¨è‡ªåŠ¨åŠ è½½ä¸‹ä¸€é¡µï¼ˆæ¯é¡µ20å°ï¼‰
6. ç‚¹å‡»é‚®ä»¶æŸ¥çœ‹è¯¦æƒ…ï¼ˆæ”¯æŒ HTML æ¸²æŸ“ï¼‰
7. ç‚¹å‡»ã€ŒğŸ” å…¨å±æŸ¥çœ‹ã€æŒ‰é’®ï¼Œåœ¨å…¨å±æ¨¡å¼ä¸‹æŸ¥çœ‹å®Œæ•´é‚®ä»¶å†…å®¹

**å…¨å±æŸ¥çœ‹åŠŸèƒ½ï¼š**
- æ”¯æŒæ»šåŠ¨æŸ¥çœ‹é•¿é‚®ä»¶çš„å®Œæ•´å†…å®¹
- æŒ‰ ESC é”®æˆ–ç‚¹å‡»èƒŒæ™¯åŒºåŸŸå…³é—­å…¨å±æ¨¡å¼
- è‡ªåŠ¨è°ƒæ•´å†…å®¹é«˜åº¦ï¼Œç¡®ä¿é‚®ä»¶å®Œæ•´æ˜¾ç¤º
- æ”¯æŒ HTML é‚®ä»¶å’Œçº¯æ–‡æœ¬é‚®ä»¶

**æ³¨æ„ï¼š** åˆ‡æ¢æ–‡ä»¶å¤¹æ ‡ç­¾åéœ€è¦ç‚¹å‡»ã€Œè·å–é‚®ä»¶ã€æŒ‰é’®é‡æ–°åŠ è½½ã€‚

### 4. ä¸´æ—¶é‚®ç®±åŠŸèƒ½

ç³»ç»Ÿé›†æˆäº† GPTMail API æä¾›ä¸´æ—¶é‚®ç®±æœåŠ¡ï¼š

1. **ç”Ÿæˆä¸´æ—¶é‚®ç®±** - ç‚¹å‡»ã€Œä¸´æ—¶é‚®ç®±ã€åˆ†ç»„ï¼Œç„¶åç‚¹å‡»ã€Œç”Ÿæˆä¸´æ—¶é‚®ç®±ã€æŒ‰é’®
2. **æŸ¥çœ‹é‚®ä»¶** - é€‰æ‹©ä¸´æ—¶é‚®ç®±åç‚¹å‡»ã€Œè·å–é‚®ä»¶ã€æŒ‰é’®
3. **åˆ·æ–°é‚®ä»¶** - ç‚¹å‡»ã€Œåˆ·æ–°ã€æŒ‰é’®è·å–æœ€æ–°é‚®ä»¶
4. **æ¸…ç©ºé‚®ä»¶** - ç‚¹å‡»ã€Œæ¸…ç©ºã€æŒ‰é’®ï¼Œæ¸…ç©ºè¯¥é‚®ç®±çš„æ‰€æœ‰é‚®ä»¶
5. **åˆ é™¤é‚®ç®±** - ç‚¹å‡»ã€Œåˆ é™¤ã€æŒ‰é’®ï¼Œåˆ é™¤é‚®ç®±åŠå…¶æ‰€æœ‰é‚®ä»¶

ä¸´æ—¶é‚®ç®±æ•°æ®ä¼šå­˜å‚¨åœ¨æœ¬åœ°æ•°æ®åº“ä¸­ï¼Œæ–¹ä¾¿åç»­æŸ¥çœ‹ã€‚

### 5. åˆ†ç»„ç®¡ç†

- **åˆ›å»ºåˆ†ç»„** - ç‚¹å‡»åˆ†ç»„é¢æ¿çš„ã€Œ+ã€æŒ‰é’®
- **ç¼–è¾‘åˆ†ç»„** - ç‚¹å‡»åˆ†ç»„æ—çš„ã€Œç¼–è¾‘ã€æŒ‰é’®ï¼Œå¯ä¿®æ”¹åç§°ã€æè¿°å’Œé¢œè‰²
- **åˆ é™¤åˆ†ç»„** - ç‚¹å‡»åˆ†ç»„æ—çš„ã€Œåˆ é™¤ã€æŒ‰é’®ï¼ˆé»˜è®¤åˆ†ç»„ä¸å¯åˆ é™¤ï¼‰
- **å¯¼å‡ºåˆ†ç»„** - ç‚¹å‡»åˆ†ç»„æ—çš„ã€Œå¯¼å‡ºã€æŒ‰é’®ï¼Œå¯¼å‡ºè¯¥åˆ†ç»„ä¸‹çš„æ‰€æœ‰é‚®ç®±è´¦å·

### 6. ç³»ç»Ÿè®¾ç½®

ç‚¹å‡»å¯¼èˆªæ çš„ã€Œâš™ï¸ è®¾ç½®ã€æŒ‰é’®ï¼Œå¯ä»¥ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

1. **ç™»å½•å¯†ç ** - ä¿®æ”¹ Web ç•Œé¢çš„ç™»å½•å¯†ç ï¼ˆè‡³å°‘4ä½ï¼‰
2. **GPTMail API Key** - è®¾ç½®ä¸´æ—¶é‚®ç®±åŠŸèƒ½æ‰€éœ€çš„ API Key

è®¾ç½®ä¼šä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œé‡å¯åº”ç”¨åä»ç„¶æœ‰æ•ˆã€‚

### 7. Token åˆ·æ–°ç®¡ç†ï¼ˆâ­ 2026-01-23 æ–°å¢ï¼‰

ä¸ºäº†é˜²æ­¢ Refresh Token å›  90 å¤©ä¸ä½¿ç”¨è€Œè¿‡æœŸï¼Œç³»ç»Ÿæä¾›äº†å…¨é‡åˆ·æ–°åŠŸèƒ½ï¼š

#### åŠŸèƒ½ç‰¹æ€§
- **å…¨é‡åˆ·æ–°** - ä¸€é”®æµ‹è¯•æ‰€æœ‰è´¦å·çš„ Token æœ‰æ•ˆæ€§
- **å®æ—¶è¿›åº¦** - æ˜¾ç¤ºå½“å‰å¤„ç†çš„è´¦å·ã€æˆåŠŸ/å¤±è´¥æ•°é‡
- **åˆ·æ–°ç»Ÿè®¡** - æ˜¾ç¤ºæœ¬æ¬¡åˆ·æ–°çš„æ€»æ•°ã€æˆåŠŸæ•°ã€å¤±è´¥æ•°
- **å¤±è´¥é‡è¯•** - æ”¯æŒå•ä¸ªæˆ–æ‰¹é‡é‡è¯•å¤±è´¥çš„è´¦å·
- **æˆåŠŸåˆ—è¡¨** - æŸ¥çœ‹æ‰€æœ‰åˆ·æ–°æˆåŠŸçš„è´¦å·
- **å¤±è´¥åˆ—è¡¨** - æŸ¥çœ‹å¤±è´¥åŸå› ï¼Œæ”¯æŒå•ç‹¬é‡è¯•
- **è®°å½•ç®¡ç†** - åªä¿ç•™æœ€è¿‘ä¸€æ¬¡å…¨é‡åˆ·æ–°è®°å½•ï¼Œé¿å…æ•°æ®å†—ä½™

#### ä½¿ç”¨æ–¹æ³•
1. ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„ã€Œå…¨é‡åˆ·æ–°Tokenã€æŒ‰é’®
2. ç¡®è®¤åˆ·æ–°æç¤ºï¼ˆä¼šæ¸…é™¤ä¹‹å‰çš„è®°å½•ï¼‰
3. å®æ—¶æŸ¥çœ‹åˆ·æ–°è¿›åº¦å’Œç»Ÿè®¡
4. åˆ·æ–°å®ŒæˆåæŸ¥çœ‹ç»“æœ
5. å¦‚æœ‰å¤±è´¥ï¼Œå¯ç‚¹å‡»ã€Œå¤±è´¥åˆ—è¡¨ã€æŸ¥çœ‹è¯¦æƒ…å¹¶é‡è¯•

#### å»ºè®®
- å»ºè®®æ¯æœˆè‡³å°‘æ‰§è¡Œä¸€æ¬¡å…¨é‡åˆ·æ–°
- åŠæ—¶å¤„ç†å¤±è´¥çš„è´¦å·ï¼Œé‡æ–°è·å– Token
- å®šæœŸæŸ¥çœ‹åˆ·æ–°å†å²ï¼Œäº†è§£è´¦å·å¥åº·çŠ¶æ€
![å…¨é‡åˆ·æ–°Token](img/å…¨é‡åˆ·æ–°token.png)
![å…¨é‡åˆ·æ–°Token](img/å…¨é‡åˆ·æ–°token-å¤±è´¥.png)


## ğŸŒ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### ä½¿ç”¨ Nginx + HTTPS

**1. å®‰è£… Nginx**
```bash
sudo apt install nginx certbot python3-certbot-nginx -y
```

**2. é…ç½® Nginx** `/etc/nginx/sites-available/outlook-mail-reader`
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # WebSocket æ”¯æŒï¼ˆå¦‚æœéœ€è¦ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

**3. å¯ç”¨é…ç½®**
```bash
sudo ln -s /etc/nginx/sites-available/outlook-mail-reader /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

**4. é…ç½® HTTPS**
```bash
sudo certbot --nginx -d your-domain.com
```

### ä½¿ç”¨ Caddyï¼ˆæ›´ç®€å•ï¼‰

```bash
# å®‰è£… Caddy
sudo apt install caddy -y

# é…ç½® /etc/caddy/Caddyfile
your-domain.com {
    reverse_proxy localhost:5000
}

# é‡è½½ï¼ˆè‡ªåŠ¨ HTTPSï¼‰
sudo systemctl reload caddy
```

## ğŸ” å®‰å…¨é…ç½®

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 

**æ–¹å¼ä¸€ï¼šé€šè¿‡ç¯å¢ƒå˜é‡**

åœ¨ `docker-compose.yml` ä¸­ï¼š
```yaml
environment:
  - LOGIN_PASSWORD=your_secure_password_here
  - SECRET_KEY=your-random-secret-key-here
```

**æ–¹å¼äºŒï¼šé€šè¿‡ Web ç•Œé¢**

ç™»å½•åç‚¹å‡»ã€Œâš™ï¸ è®¾ç½®ã€æŒ‰é’®ï¼Œåœ¨çº¿ä¿®æ”¹ç™»å½•å¯†ç ã€‚

### 2. é…ç½®é˜²ç«å¢™

```bash
# å…è®¸ HTTP å’Œ HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# å¦‚æœç›´æ¥è®¿é—®åº”ç”¨ç«¯å£
sudo ufw allow 5000/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable
```

### 3. é™åˆ¶è®¿é—®æ¥æºï¼ˆNginxï¼‰

```nginx
location / {
    # åªå…è®¸å†…ç½‘è®¿é—®
    allow 192.168.1.0/24;
    deny all;

    proxy_pass http://localhost:5000;
}
```

### 4. ä½¿ç”¨å¼ºå¯†ç 

- ç™»å½•å¯†ç è‡³å°‘ 8 ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
- SECRET_KEY ä½¿ç”¨éšæœºç”Ÿæˆçš„é•¿å­—ç¬¦ä¸²
- å®šæœŸæ›´æ¢å¯†ç 

### 5. æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
cp data/outlook_accounts.db data/outlook_accounts.db.backup

# å®šæœŸå¤‡ä»½ï¼ˆcrontabï¼‰
0 2 * * * cp /path/to/data/outlook_accounts.db /path/to/backup/outlook_accounts.db.$(date +\%Y\%m\%d)
```

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### å®¹å™¨æ— æ³•å¯åŠ¨

**æ£€æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps -a

# 2. æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker logs outlook-mail-reader

# 3. æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :5000

# 4. é‡æ–°æ‹‰å–é•œåƒå¹¶é‡å¯
docker pull ghcr.io/assast/outlookemail:latest
docker-compose down
docker-compose up -d
```

**æ­£ç¡®çš„æ—¥å¿—åº”è¯¥æ˜¾ç¤ºï¼š**
```
============================================================
Outlook é‚®ä»¶ Web åº”ç”¨å·²åˆå§‹åŒ–
æ•°æ®åº“æ–‡ä»¶: data/outlook_accounts.db
GPTMail API: https://mail.chatgpt.org.uk
============================================================
```

### æ•°æ®åº“è¡¨ä¸å­˜åœ¨é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š** `sqlite3.OperationalError: no such table: settings`

**åŸå› ï¼š** æ•°æ®åº“æœªåˆå§‹åŒ–æˆ–æŸå

**è§£å†³æ–¹æ³•ï¼š**

```bash
# æ–¹æ³• 1ï¼šåˆ é™¤æ—§æ•°æ®åº“ï¼Œé‡æ–°åˆå§‹åŒ–
docker-compose down
rm -rf data/outlook_accounts.db
docker-compose up -d

# æ–¹æ³• 2ï¼šæ‰‹åŠ¨åˆå§‹åŒ–æ•°æ®åº“
docker exec outlook-mail-reader python -c "from web_outlook_app import init_db; init_db()"
docker-compose restart

# æ–¹æ³• 3ï¼šä½¿ç”¨æœ€æ–°é•œåƒ
docker pull ghcr.io/assast/outlookemail:latest
docker-compose down
docker-compose up -d
```

### æ— æ³•è·å–é‚®ä»¶

**å¯èƒ½åŸå› ï¼š**
1. Refresh Token è¿‡æœŸæˆ–æ— æ•ˆ
2. Client ID é”™è¯¯
3. API æƒé™ä¸è¶³
4. ç½‘ç»œè¿æ¥é—®é¢˜

**è§£å†³æ–¹æ³•ï¼š**

1. **é‡æ–°è·å– Refresh Token**
   - ä½¿ç”¨å†…ç½®çš„ OAuth2 åŠ©æ‰‹é‡æ–°è·å–
   - ç¡®ä¿ Azure åº”ç”¨é…ç½®æ­£ç¡®

2. **æ£€æŸ¥ API æƒé™**
   - ç¡®ä¿å·²æ·»åŠ æ‰€éœ€çš„ API æƒé™
   - ç¡®ä¿å·²æˆäºˆç®¡ç†å‘˜åŒæ„ï¼ˆå¦‚æœéœ€è¦ï¼‰

3. **æŸ¥çœ‹è¯¦ç»†é”™è¯¯**
   - æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
   - æŸ¥çœ‹ Network æ ‡ç­¾ä¸­çš„ API å“åº”

### 502 é”™è¯¯ï¼ˆNginxï¼‰

**åŸå› ï¼š** åº”ç”¨æœªæ­£å¸¸å¯åŠ¨æˆ–ç«¯å£é…ç½®é”™è¯¯

**è§£å†³æ–¹æ³•ï¼š**

```bash
# 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps

# 2. æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs

# 3. æµ‹è¯•åº”ç”¨æ˜¯å¦å“åº”
curl http://localhost:5000/login

# 4. æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# 5. é‡å¯æœåŠ¡
docker-compose restart
sudo systemctl reload nginx
```

### ä¸´æ—¶é‚®ç®±åŠŸèƒ½ä¸å¯ç”¨

**å¯èƒ½åŸå› ï¼š**
1. GPTMail API Key æ— æ•ˆ
2. GPTMail æœåŠ¡ä¸å¯ç”¨
3. ç½‘ç»œè¿æ¥é—®é¢˜

**è§£å†³æ–¹æ³•ï¼š**

1. **æ›´æ–° API Key**
   - åœ¨ã€Œâš™ï¸ è®¾ç½®ã€ä¸­æ›´æ–° GPTMail API Key
   - æˆ–åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½® `GPTMAIL_API_KEY`

2. **æ£€æŸ¥æœåŠ¡çŠ¶æ€**
   - è®¿é—® GPTMail å®˜ç½‘ç¡®è®¤æœåŠ¡çŠ¶æ€
   - æŸ¥çœ‹åº”ç”¨æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

### Session è¿‡æœŸé—®é¢˜

**ç°è±¡ï¼š** é¢‘ç¹éœ€è¦é‡æ–°ç™»å½•

**è§£å†³æ–¹æ³•ï¼š**

1. **è®¾ç½®å›ºå®šçš„ SECRET_KEY**
   ```yaml
   environment:
     - SECRET_KEY=your-fixed-secret-key-here
   ```

2. **æ£€æŸ¥ Session é…ç½®**
   - é»˜è®¤ Session æœ‰æ•ˆæœŸä¸º 7 å¤©
   - é‡å¯åº”ç”¨ä¸ä¼šå¯¼è‡´ Session å¤±æ•ˆï¼ˆå¦‚æœä½¿ç”¨å›ºå®š SECRET_KEYï¼‰

### æ•°æ®åº“é”å®šé”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š** `sqlite3.OperationalError: database is locked`

**åŸå› ï¼š** å¤šä¸ªè¿›ç¨‹åŒæ—¶è®¿é—®æ•°æ®åº“

**è§£å†³æ–¹æ³•ï¼š**

```bash
# 1. é‡å¯åº”ç”¨
docker-compose restart

# 2. å¦‚æœé—®é¢˜æŒç»­ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–è¿›ç¨‹è®¿é—®æ•°æ®åº“
lsof data/outlook_accounts.db

# 3. å¤‡ä»½å¹¶é‡å»ºæ•°æ®åº“
cp data/outlook_accounts.db data/outlook_accounts.db.backup
docker-compose down
docker-compose up -d
```

## ğŸ”„ æ›´æ–°åº”ç”¨

### æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬

```bash
# æ‹‰å–æœ€æ–°é•œåƒ
docker pull ghcr.io/assast/outlookemail:latest

# é‡å¯æœåŠ¡
docker-compose down
docker-compose up -d

# æˆ–ä½¿ç”¨ Docker å‘½ä»¤
docker stop outlook-mail-reader
docker rm outlook-mail-reader
docker run -d \
  --name outlook-mail-reader \
  -p 5000:5000 \
  -v $(pwd)/data:/app/data \
  -e LOGIN_PASSWORD=admin123 \
  -e SECRET_KEY=your-secret-key-here \
  ghcr.io/assast/outlookemail:latest
```

### æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯

```bash
# æŸ¥çœ‹é•œåƒä¿¡æ¯
docker images ghcr.io/assast/outlookemail

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs outlook-mail-reader
```

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯æŠ€æœ¯æ ˆ

- **Flask 3.0+** - Web æ¡†æ¶
- **SQLite 3** - æ•°æ®åº“
- **Requests** - HTTP å®¢æˆ·ç«¯
- **IMAP4_SSL** - IMAP åè®®æ”¯æŒ
- **Microsoft Graph API** - Outlook é‚®ä»¶ API

### å‰ç«¯æŠ€æœ¯æ ˆ

- **åŸç”Ÿ JavaScript** - æ— æ¡†æ¶ä¾èµ–
- **CSS3** - ç°ä»£åŒ–æ ·å¼
- **Fetch API** - å¼‚æ­¥è¯·æ±‚

### æ•°æ®åº“è®¾è®¡

#### settings è¡¨
å­˜å‚¨ç³»ç»Ÿè®¾ç½®ï¼š
- `key` - è®¾ç½®é”®ï¼ˆä¸»é”®ï¼‰
- `value` - è®¾ç½®å€¼
- `updated_at` - æ›´æ–°æ—¶é—´

#### groups è¡¨
å­˜å‚¨é‚®ç®±åˆ†ç»„ï¼š
- `id` - åˆ†ç»„ IDï¼ˆä¸»é”®ï¼‰
- `name` - åˆ†ç»„åç§°ï¼ˆå”¯ä¸€ï¼‰
- `description` - åˆ†ç»„æè¿°
- `color` - åˆ†ç»„é¢œè‰²
- `is_system` - æ˜¯å¦ç³»ç»Ÿåˆ†ç»„
- `created_at` - åˆ›å»ºæ—¶é—´

#### accounts è¡¨
å­˜å‚¨ Outlook é‚®ç®±è´¦å·ï¼š
- `id` - è´¦å· IDï¼ˆä¸»é”®ï¼‰
- `email` - é‚®ç®±åœ°å€ï¼ˆå”¯ä¸€ï¼‰
- `password` - é‚®ç®±å¯†ç 
- `client_id` - OAuth å®¢æˆ·ç«¯ ID
- `refresh_token` - OAuth åˆ·æ–°ä»¤ç‰Œ
- `group_id` - æ‰€å±åˆ†ç»„ IDï¼ˆå¤–é”®ï¼‰
- `remark` - å¤‡æ³¨
- `status` - è´¦å·çŠ¶æ€
- `last_refresh_at` - æœ€ååˆ·æ–°æ—¶é—´ï¼ˆâ­ 2026-01-23 æ–°å¢ï¼‰
- `created_at` - åˆ›å»ºæ—¶é—´
- `updated_at` - æ›´æ–°æ—¶é—´

#### account_refresh_logs è¡¨ï¼ˆâ­ 2026-01-23 æ–°å¢ï¼‰
å­˜å‚¨è´¦å·åˆ·æ–°è®°å½•ï¼š
- `id` - è®°å½• IDï¼ˆä¸»é”®ï¼‰
- `account_id` - è´¦å· IDï¼ˆå¤–é”®ï¼‰
- `account_email` - è´¦å·é‚®ç®±
- `refresh_type` - åˆ·æ–°ç±»å‹ï¼ˆmanual/retry/autoï¼‰
- `status` - åˆ·æ–°çŠ¶æ€ï¼ˆsuccess/failedï¼‰
- `error_message` - é”™è¯¯ä¿¡æ¯
- `created_at` - åˆ›å»ºæ—¶é—´

#### temp_emails è¡¨
å­˜å‚¨ä¸´æ—¶é‚®ç®±ï¼š
- `id` - é‚®ç®± IDï¼ˆä¸»é”®ï¼‰
- `email` - é‚®ç®±åœ°å€ï¼ˆå”¯ä¸€ï¼‰
- `status` - é‚®ç®±çŠ¶æ€
- `created_at` - åˆ›å»ºæ—¶é—´
- `updated_at` - æ›´æ–°æ—¶é—´

#### temp_email_messages è¡¨
å­˜å‚¨ä¸´æ—¶é‚®ç®±çš„é‚®ä»¶ï¼š
- `id` - é‚®ä»¶ IDï¼ˆä¸»é”®ï¼‰
- `message_id` - é‚®ä»¶å”¯ä¸€æ ‡è¯†ï¼ˆå”¯ä¸€ï¼‰
- `email_address` - é‚®ç®±åœ°å€ï¼ˆå¤–é”®ï¼‰
- `from_address` - å‘ä»¶äºº
- `subject` - é‚®ä»¶ä¸»é¢˜
- `content` - çº¯æ–‡æœ¬å†…å®¹
- `html_content` - HTML å†…å®¹
- `has_html` - æ˜¯å¦åŒ…å« HTML
- `timestamp` - æ—¶é—´æˆ³
- `created_at` - åˆ›å»ºæ—¶é—´

### API ç«¯ç‚¹

#### è®¤è¯ç›¸å…³
- `GET /login` - ç™»å½•é¡µé¢
- `POST /login` - ç™»å½•éªŒè¯
- `GET /logout` - é€€å‡ºç™»å½•

#### åˆ†ç»„ç®¡ç†
- `GET /api/groups` - è·å–æ‰€æœ‰åˆ†ç»„
- `GET /api/groups/<id>` - è·å–å•ä¸ªåˆ†ç»„
- `POST /api/groups` - åˆ›å»ºåˆ†ç»„
- `PUT /api/groups/<id>` - æ›´æ–°åˆ†ç»„
- `DELETE /api/groups/<id>` - åˆ é™¤åˆ†ç»„
- `GET /api/groups/<id>/export` - å¯¼å‡ºåˆ†ç»„è´¦å·

#### è´¦å·ç®¡ç†
- `GET /api/accounts` - è·å–æ‰€æœ‰è´¦å·
- `GET /api/accounts/<id>` - è·å–å•ä¸ªè´¦å·
- `POST /api/accounts` - æ·»åŠ è´¦å·
- `PUT /api/accounts/<id>` - æ›´æ–°è´¦å·
- `DELETE /api/accounts/<id>` - åˆ é™¤è´¦å·
- `GET /api/accounts/export` - å¯¼å‡ºæ‰€æœ‰è´¦å·
- `POST /api/accounts/export-selected` - å¯¼å‡ºé€‰ä¸­åˆ†ç»„è´¦å·

#### Token åˆ·æ–°ç®¡ç†ï¼ˆâ­ 2026-01-23 æ–°å¢ï¼‰
- `GET /api/accounts/refresh-all` - å…¨é‡åˆ·æ–°æ‰€æœ‰è´¦å·ï¼ˆæµå¼å“åº”ï¼‰
- `POST /api/accounts/<id>/refresh` - åˆ·æ–°å•ä¸ªè´¦å·
- `POST /api/accounts/refresh-failed` - é‡è¯•æ‰€æœ‰å¤±è´¥çš„è´¦å·
- `POST /api/accounts/<id>/retry-refresh` - é‡è¯•å•ä¸ªè´¦å·
- `GET /api/accounts/refresh-logs` - è·å–åˆ·æ–°å†å²
- `GET /api/accounts/<id>/refresh-logs` - è·å–å•ä¸ªè´¦å·çš„åˆ·æ–°å†å²
- `GET /api/accounts/refresh-logs/failed` - è·å–å¤±è´¥çš„åˆ·æ–°è®°å½•
- `GET /api/accounts/refresh-stats` - è·å–åˆ·æ–°ç»Ÿè®¡ä¿¡æ¯

#### é‚®ä»¶æ“ä½œ
- `GET /api/emails/<email>` - è·å–é‚®ä»¶åˆ—è¡¨
- `GET /api/email/<email>/<message_id>` - è·å–é‚®ä»¶è¯¦æƒ…

#### ä¸´æ—¶é‚®ç®±
- `GET /api/temp-emails` - è·å–æ‰€æœ‰ä¸´æ—¶é‚®ç®±
- `POST /api/temp-emails/generate` - ç”Ÿæˆä¸´æ—¶é‚®ç®±
- `DELETE /api/temp-emails/<email>` - åˆ é™¤ä¸´æ—¶é‚®ç®±
- `GET /api/temp-emails/<email>/messages` - è·å–ä¸´æ—¶é‚®ç®±é‚®ä»¶
- `GET /api/temp-emails/<email>/messages/<id>` - è·å–ä¸´æ—¶é‚®ä»¶è¯¦æƒ…
- `DELETE /api/temp-emails/<email>/messages/<id>` - åˆ é™¤ä¸´æ—¶é‚®ä»¶
- `DELETE /api/temp-emails/<email>/clear` - æ¸…ç©ºä¸´æ—¶é‚®ç®±
- `POST /api/temp-emails/<email>/refresh` - åˆ·æ–°ä¸´æ—¶é‚®ç®±

#### OAuth2 åŠ©æ‰‹
- `GET /api/oauth/auth-url` - ç”Ÿæˆæˆæƒ URL
- `POST /api/oauth/exchange-token` - æ¢å– Refresh Token

#### ç³»ç»Ÿè®¾ç½®
- `GET /api/settings` - è·å–æ‰€æœ‰è®¾ç½®
- `PUT /api/settings` - æ›´æ–°è®¾ç½®

### ç‰¹æ€§è¯´æ˜

#### 1. å¤šç§é‚®ä»¶è¯»å–æ–¹å¼
- **Graph API**ï¼šæ¨èæ–¹å¼ï¼ŒåŠŸèƒ½æœ€å®Œæ•´ï¼Œæ”¯æŒæ‰€æœ‰æ–‡ä»¶å¤¹
- **IMAPï¼ˆæ–°ç‰ˆï¼‰**ï¼šä½¿ç”¨ `outlook.live.com` æœåŠ¡å™¨
- **IMAPï¼ˆæ—§ç‰ˆï¼‰**ï¼šä½¿ç”¨ `outlook.office365.com` æœåŠ¡å™¨

#### 2. æ™ºèƒ½ç¼“å­˜æœºåˆ¶
- é‚®ç®±åˆ—è¡¨ç¼“å­˜åœ¨å‰ç«¯ï¼Œå¿«é€Ÿåˆ‡æ¢åˆ†ç»„
- é‚®ä»¶åˆ—è¡¨ä¸ä½¿ç”¨ç¼“å­˜ï¼Œç¡®ä¿æ•°æ®å®æ—¶æ€§
- Session æŒä¹…åŒ–ï¼Œé‡å¯ä¸ä¸¢å¤±ç™»å½•çŠ¶æ€

#### 3. åˆ†é¡µåŠ è½½
- æ¯é¡µåŠ è½½ 20 å°é‚®ä»¶
- æ»šåŠ¨åˆ°åº•éƒ¨è‡ªåŠ¨åŠ è½½ä¸‹ä¸€é¡µ
- æ”¯æŒ `skip` å’Œ `top` å‚æ•°æ§åˆ¶åˆ†é¡µ

#### 4. å®‰å…¨ç‰¹æ€§
- å¯†ç åŠ å¯†å­˜å‚¨ï¼ˆå¯é€‰ï¼‰
- Session å¯†é’¥é…ç½®
- ç™»å½•éªŒè¯è£…é¥°å™¨
- æ•æ„Ÿä¿¡æ¯éšè—ï¼ˆAPI å“åº”ä¸­ï¼‰

#### 5. ä¸´æ—¶é‚®ç®±é›†æˆ
- é›†æˆ GPTMail API
- æœ¬åœ°æ•°æ®åº“ç¼“å­˜
- æ”¯æŒè‡ªå®šä¹‰å‰ç¼€å’ŒåŸŸå
- è‡ªåŠ¨åˆ·æ–°é‚®ä»¶

## ğŸ“ ä¾èµ–è¯´æ˜

### Python ä¾èµ–

```txt
Flask>=3.0.0
Werkzeug>=3.0.0
requests>=2.25.0
```

### ç³»ç»Ÿè¦æ±‚

- Python 3.8+
- SQLite 3
- Dockerï¼ˆå¯é€‰ï¼‰
- 2GB+ å†…å­˜
- 1GB+ ç£ç›˜ç©ºé—´

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæ— æ³•è·å–é‚®ä»¶ï¼Ÿ
A: è¯·æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. Refresh Token æ˜¯å¦æœ‰æ•ˆï¼ˆå¯èƒ½å·²è¿‡æœŸï¼‰
2. Client ID æ˜¯å¦æ­£ç¡®
3. Azure åº”ç”¨æ˜¯å¦é…ç½®äº†æ­£ç¡®çš„ API æƒé™
4. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
5. å°è¯•ä½¿ç”¨å†…ç½®çš„ OAuth2 åŠ©æ‰‹é‡æ–°è·å– Token

### Q: å¦‚ä½•è·å– Refresh Tokenï¼Ÿ
A: ä½¿ç”¨æœ¬å·¥å…·å†…ç½®çš„ OAuth2 åŠ©æ‰‹ï¼š
1. ç‚¹å‡»å¯¼èˆªæ çš„ã€Œè·å– Tokenã€æŒ‰é’®
2. ç‚¹å‡»ã€Œç”Ÿæˆæˆæƒé“¾æ¥ã€
3. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é“¾æ¥å¹¶å®Œæˆæˆæƒ
4. å¤åˆ¶æˆæƒåçš„å®Œæ•´ URL
5. ç²˜è´´åˆ°ã€Œæˆæƒåçš„ URLã€è¾“å…¥æ¡†
6. ç‚¹å‡»ã€Œæ¢å– Tokenã€æŒ‰é’®
7. å¤åˆ¶è·å¾—çš„ Refresh Token

### Q: ä¸´æ—¶é‚®ç®±åŠŸèƒ½å¦‚ä½•ä½¿ç”¨ï¼Ÿ
A: ä¸´æ—¶é‚®ç®±åŠŸèƒ½é›†æˆäº† GPTMail APIï¼š
1. ç‚¹å‡»ã€Œä¸´æ—¶é‚®ç®±ã€åˆ†ç»„
2. ç‚¹å‡»ã€Œç”Ÿæˆä¸´æ—¶é‚®ç®±ã€æŒ‰é’®
3. é€‰æ‹©ç”Ÿæˆçš„é‚®ç®±ï¼Œç‚¹å‡»ã€Œè·å–é‚®ä»¶ã€æŸ¥çœ‹é‚®ä»¶
4. ä¸´æ—¶é‚®ç®±æ•°æ®ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°æ•°æ®åº“

### Q: å¦‚ä½•ä¿®æ”¹ç™»å½•å¯†ç ï¼Ÿ
A: æœ‰ä¸¤ç§æ–¹å¼ï¼š
1. é€šè¿‡ Web ç•Œé¢ï¼šç™»å½•åç‚¹å‡»ã€Œâš™ï¸ è®¾ç½®ã€æŒ‰é’®ï¼Œåœ¨çº¿ä¿®æ”¹
2. é€šè¿‡ç¯å¢ƒå˜é‡ï¼šåœ¨ `docker-compose.yml` ä¸­è®¾ç½® `LOGIN_PASSWORD`

### Q: æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ
A: æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨ SQLite æ•°æ®åº“ä¸­ï¼Œä½äº `data/outlook_accounts.db`ã€‚å»ºè®®å®šæœŸå¤‡ä»½æ­¤æ–‡ä»¶ã€‚

### Q: æ”¯æŒå“ªäº›é‚®ä»¶æ–‡ä»¶å¤¹ï¼Ÿ
A: ç›®å‰æ”¯æŒä»¥ä¸‹æ–‡ä»¶å¤¹ï¼š
- æ”¶ä»¶ç®±ï¼ˆInboxï¼‰
- åƒåœ¾é‚®ä»¶ï¼ˆJunk Emailï¼‰
- å·²åˆ é™¤é‚®ä»¶ï¼ˆDeleted Itemsï¼‰

### Q: å¦‚ä½•æ‰¹é‡å¯¼å…¥é‚®ç®±ï¼Ÿ
A: åœ¨ã€Œå¯¼å…¥é‚®ç®±ã€å¯¹è¯æ¡†ä¸­ï¼Œæ¯è¡Œè¾“å…¥ä¸€ä¸ªè´¦å·ï¼Œæ ¼å¼ä¸ºï¼š
```
é‚®ç®±----å¯†ç ----client_id----refresh_token
```
æ”¯æŒä¸€æ¬¡å¯¼å…¥å¤šä¸ªè´¦å·ã€‚

### Q: é‚®ä»¶åˆ—è¡¨æ˜¯å¦æœ‰ç¼“å­˜ï¼Ÿ
A: é‚®ä»¶åˆ—è¡¨ä¸ä½¿ç”¨ç¼“å­˜ï¼Œæ¯æ¬¡ç‚¹å‡»ã€Œè·å–é‚®ä»¶ã€éƒ½ä¼šä»æœåŠ¡å™¨è·å–æœ€æ–°æ•°æ®ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿é‚®ä»¶æ•°æ®çš„å®æ—¶æ€§ã€‚

### Q: å¦‚ä½•å¯¼å‡ºé‚®ç®±è´¦å·ï¼Ÿ
A: æœ‰ä¸‰ç§å¯¼å‡ºæ–¹å¼ï¼š
1. å¯¼å‡ºå•ä¸ªåˆ†ç»„ï¼šç‚¹å‡»åˆ†ç»„æ—çš„ã€Œå¯¼å‡ºã€æŒ‰é’®
2. å¯¼å‡ºæ‰€æœ‰è´¦å·ï¼šç‚¹å‡»å¯¼èˆªæ çš„ã€Œå¯¼å‡ºå…¨éƒ¨ã€æŒ‰é’®
3. å¯¼å‡ºé€‰ä¸­åˆ†ç»„ï¼šé€‰æ‹©å¤šä¸ªåˆ†ç»„åç‚¹å‡»ã€Œå¯¼å‡ºé€‰ä¸­ã€æŒ‰é’®

### Q: Docker å®¹å™¨æ— æ³•å¯åŠ¨æ€ä¹ˆåŠï¼Ÿ
A: è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š
1. æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼š`docker logs outlook-mail-reader`
2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`lsof -i :5000`
3. ç¡®ä¿æ•°æ®ç›®å½•æœ‰å†™å…¥æƒé™
4. å°è¯•é‡æ–°æ‹‰å–æœ€æ–°é•œåƒ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Docker Compose æ–‡æ¡£](https://docs.docker.com/compose/)
- [Microsoft Graph API æ–‡æ¡£](https://docs.microsoft.com/graph/)
- [Microsoft Identity Platform æ–‡æ¡£](https://docs.microsoft.com/azure/active-directory/develop/)
- [Flask å®˜æ–¹æ–‡æ¡£](https://flask.palletsprojects.com/)
- [SQLite å®˜æ–¹æ–‡æ¡£](https://www.sqlite.org/docs.html)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### è´¡çŒ®æŒ‡å—

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/assast/outlookEmail.git
cd outlookEmail

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œåº”ç”¨
python web_outlook_app.py
```

## ğŸ“„ è®¸å¯è¯

MIT License

Copyright (c) 2024

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

## ğŸ™ è‡´è°¢

- [Microsoft Graph API](https://docs.microsoft.com/graph/) - æä¾› Outlook é‚®ä»¶ API
- [GPTMail](https://mail.chatgpt.org.uk) - æä¾›ä¸´æ—¶é‚®ç®±æœåŠ¡
- [Flask](https://flask.palletsprojects.com/) - Web æ¡†æ¶
- æ‰€æœ‰è´¡çŒ®è€…å’Œä½¿ç”¨è€…

## ğŸ“ è”ç³»æ–¹å¼

- GitHub Issues: [https://github.com/assast/outlookEmail/issues](https://github.com/assast/outlookEmail/issues)
- Email: é€šè¿‡ GitHub Issues è”ç³»

---

## ğŸ“‹ æ›´æ–°æ—¥å¿—

### 2026-01-23 - Token åˆ·æ–°ç®¡ç†åŠŸèƒ½

#### æ–°å¢åŠŸèƒ½
- âœ¨ **å…¨é‡åˆ·æ–° Token** - ä¸€é”®æµ‹è¯•æ‰€æœ‰è´¦å·çš„ Refresh Token æœ‰æ•ˆæ€§
- ğŸ“Š **å®æ—¶è¿›åº¦å±•ç¤º** - ä½¿ç”¨ Server-Sent Events å®ç°æµå¼å“åº”ï¼Œå®æ—¶æ˜¾ç¤ºåˆ·æ–°è¿›åº¦
- ğŸ“ˆ **åˆ·æ–°ç»Ÿè®¡** - æ˜¾ç¤ºæœ¬æ¬¡åˆ·æ–°çš„æ€»æ•°ã€æˆåŠŸæ•°ã€å¤±è´¥æ•°å’Œä¸Šæ¬¡åˆ·æ–°æ—¶é—´
- ğŸ” **å¤±è´¥é‡è¯•** - æ”¯æŒå•ä¸ªè´¦å·é‡è¯•å’Œæ‰¹é‡é‡è¯•æ‰€æœ‰å¤±è´¥è´¦å·
- âœ… **æˆåŠŸåˆ—è¡¨** - æŸ¥çœ‹æ‰€æœ‰åˆ·æ–°æˆåŠŸçš„è´¦å·è®°å½•
- âŒ **å¤±è´¥åˆ—è¡¨** - æŸ¥çœ‹å¤±è´¥åŸå› ï¼Œæ”¯æŒå•ç‹¬é‡è¯•
- ğŸ—„ï¸ **è®°å½•ç®¡ç†** - åªä¿ç•™æœ€è¿‘ä¸€æ¬¡å…¨é‡åˆ·æ–°è®°å½•ï¼Œé¿å…æ•°æ®å†—ä½™
- ğŸ• **æ—¶åŒºä¼˜åŒ–** - ç»Ÿä¸€ä½¿ç”¨ä¸Šæµ·æ—¶åŒºï¼ˆUTC+8ï¼‰ï¼Œç¡®ä¿æ—¶é—´æ˜¾ç¤ºå‡†ç¡®

#### æ•°æ®åº“å˜æ›´
- æ–°å¢ `account_refresh_logs` è¡¨ - å­˜å‚¨åˆ·æ–°è®°å½•
- `accounts` è¡¨æ–°å¢ `last_refresh_at` å­—æ®µ - è®°å½•æœ€ååˆ·æ–°æ—¶é—´

#### API å˜æ›´
- æ–°å¢ 8 ä¸ªåˆ·æ–°ç›¸å…³ API ç«¯ç‚¹
- ä½¿ç”¨æµå¼å“åº”ï¼ˆSSEï¼‰å®ç°å®æ—¶è¿›åº¦æ¨é€

#### æŠ€æœ¯äº®ç‚¹
- ä½¿ç”¨ EventSource API å®ç°å‰ç«¯å®æ—¶è¿›åº¦æ¥æ”¶
- ä¼˜åŒ–æ—¶åŒºå¤„ç†ï¼Œé¿å… UTC å’Œæœ¬åœ°æ—¶åŒºçš„ 8 å°æ—¶åå·®
- å®æ—¶åŒæ­¥é¡¶éƒ¨ç»Ÿè®¡æ•°æ®å’Œè¿›åº¦æ¡æ•°æ®
- æ”¹è¿›é‚®ä»¶å†…å®¹å±•ç¤ºï¼Œæ”¯æŒé•¿é‚®ä»¶å®Œæ•´æ˜¾ç¤º
- ğŸ” **å…¨å±æŸ¥çœ‹é‚®ä»¶** - æ–°å¢å…¨å±æ¨¡å¼æŸ¥çœ‹é‚®ä»¶åŠŸèƒ½ï¼Œè§£å†³é•¿é‚®ä»¶å±•ç¤ºä¸å…¨çš„é—®é¢˜
  - æ”¯æŒæ»šåŠ¨æŸ¥çœ‹å®Œæ•´é‚®ä»¶å†…å®¹
  - è‡ªåŠ¨è°ƒæ•´ iframe é«˜åº¦ï¼Œç¡®ä¿å†…å®¹å®Œæ•´æ˜¾ç¤º
  - æ”¯æŒ ESC é”®å’Œç‚¹å‡»èƒŒæ™¯å…³é—­
  - ä¼˜åŒ– HTML é‚®ä»¶å’Œçº¯æ–‡æœ¬é‚®ä»¶çš„æ˜¾ç¤ºæ•ˆæœ

#### ä½¿ç”¨å»ºè®®
- å»ºè®®æ¯æœˆè‡³å°‘æ‰§è¡Œä¸€æ¬¡å…¨é‡åˆ·æ–°ï¼Œé˜²æ­¢ Token è¿‡æœŸ
- åŠæ—¶å¤„ç†å¤±è´¥çš„è´¦å·ï¼Œé‡æ–°è·å– Refresh Token
- å®šæœŸæŸ¥çœ‹åˆ·æ–°å†å²ï¼Œäº†è§£è´¦å·å¥åº·çŠ¶æ€

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Starï¼**
